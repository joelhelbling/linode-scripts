#!/bin/bash

if [ "$1" == "" ]; then
  echo "You must provide the name of a linode you wish to rebuild"
  exit 1
fi

LABEL=$1
DISTRIBUTION="Ubuntu 16.04 LTS"
STACKSCRIPT_NAME="hbj_initial_setup"

STACKSCRIPT_ID=`linode stackscript show $STACKSCRIPT_NAME | grep id: | awk '/\s*/ {print $2}'`
ROOT_PASSWORD="passpass_`echo $LABEL | rev`_ssapssap"
JSON=`jq -c . udf.json`

echo running with json: $JSON

linode rebuild \
  --label "$LABEL" \
  --distribution "$DISTRIBUTION" \
  --password "$ROOT_PASSWORD" \
  --stackscript "$STACKSCRIPT_ID" \
  --stackscriptjson $JSON
